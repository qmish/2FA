# Runbook (операции и инциденты)

## Цель
- Быстро диагностировать и восстановить работу API/RADIUS/БД.
- Минимизировать простой и потери данных.

## Подготовка
- Доступы: Kubernetes (namespace), GitHub, registry образов, секрет‑менеджер.
- Наблюдаемость: метрики, логи, алерты.
- Документы: `production.md`, `disaster-recovery.md`, `observability.md`.

## Быстрые проверки (Triage)
- `GET /healthz` для API и `RADIUS /healthz` (если настроен).
- Метрики: `GET /metrics`, проверить `http_requests_total`, `radius_requests_total`, `redis_ping_total`.
- Логи: ошибки `system_errors_total` и error‑логи сервиса.
- Проверить доступность БД и Redis (ping).

## Частые инциденты

### API недоступен
- Проверить pod статус, liveness/readiness.
- Проверить `DB_URL`, секреты, конфиги.
- При необходимости: rollback на предыдущий тег образа.

### Ошибки авторизации/2FA
- Проверить Redis и лимиты (`AUTH_*_LIMIT`).
- Проверить провайдеры (Express Mobile/FCM).
- Проверить `provider_*` retry/CB.

### RADIUS ошибки
- Проверить `radius_requests_total` по результатам.
- Проверить RADIUS секрет и доступность UDP порта.
- Проверить внешние провайдеры (push/call/sms).

## Регламент восстановления
- Использовать `disaster-recovery.md` как основной план.
- При инциденте с БД — восстановить из последнего бэкапа и проверить миграции.

## Контроль после восстановления
- Прогнать healthchecks.
- Проверить базовые сценарии логина.
- Убедиться в отсутствии алертов.
