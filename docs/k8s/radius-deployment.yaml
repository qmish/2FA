apiVersion: apps/v1
kind: Deployment
metadata:
  name: radius-server
  labels:
    app: radius-server
spec:
  replicas: 2
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
  selector:
    matchLabels:
      app: radius-server
  template:
    metadata:
      labels:
        app: radius-server
    spec:
      serviceAccountName: radius-server
      securityContext:
        runAsNonRoot: true
        runAsUser: 10001
        runAsGroup: 10001
        fsGroup: 10001
      containers:
        - name: radius-server
          image: 2fa/radius-server:latest
          imagePullPolicy: Never
          ports:
            - containerPort: 1812
              protocol: UDP
          startupProbe:
            exec:
              command:
                - sh
                - -c
                - "pidof radius-server"
            failureThreshold: 30
            periodSeconds: 2
          resources:
            requests:
              cpu: "50m"
              memory: "64Mi"
            limits:
              cpu: "200m"
              memory: "256Mi"
          envFrom:
            - configMapRef:
                name: api-config
            - secretRef:
                name: api-secrets
