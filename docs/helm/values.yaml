replicaCount: 2
image:
  api: 2fa/api-server:latest
  radius: 2fa/radius-server:latest
  migrate: 2fa/migrate:latest

strategy:
  maxSurge: 1
  maxUnavailable: 0

resources:
  api:
    requests:
      cpu: "100m"
      memory: "128Mi"
    limits:
      cpu: "500m"
      memory: "512Mi"
  radius:
    requests:
      cpu: "50m"
      memory: "64Mi"
    limits:
      cpu: "200m"
      memory: "256Mi"

pdb:
  enabled: true
  minAvailable: 1

monitoring:
  enabled: false
  namespace: "monitoring"

hpa:
  enabled: false
  minReplicas: 2
  maxReplicas: 10
  targetCPU: 70

service:
  type: ClusterIP
  port: 80

ingress:
  enabled: false
  className: ""
  host: "2fa.local"
  tls:
    enabled: false
    secretName: "api-tls"
    clusterIssuer: "letsencrypt-prod"
  rateLimit:
    enabled: false
    rps: "5"
    burstMultiplier: "3"
    statusCode: "429"

backup:
  enabled: false
  schedule: "0 2 * * *"
  storage: "10Gi"

backupVerify:
  enabled: false
  schedule: "0 5 * * *"
  maxAgeHours: 48
  image: "alpine:3.20"

config:
  HTTP_PORT: "8080"
  RADIUS_ADDR: ":1812"
  RADIUS_HEALTH_ADDR: ":8090"
  JWT_ISSUER: "2fa"
  JWT_TTL: "15m"
  AUTH_CHALLENGE_TTL: "5m"
  SESSION_TTL: "24h"
  AUTH_LOGIN_LIMIT: "10"
  AUTH_VERIFY_LIMIT: "10"
  OTEL_EXPORTER_OTLP_ENDPOINT: ""
  OTEL_SERVICE_NAME: "2fa"
  OTEL_SAMPLE_RATIO: "1"
  PROVIDER_MAX_RETRIES: "2"
  PROVIDER_BREAKER_FAILURES: "3"
  PROVIDER_BREAKER_TIMEOUT: "30s"
  DB_MAX_OPEN_CONNS: "25"
  DB_MAX_IDLE_CONNS: "10"
  DB_CONN_MAX_LIFETIME: "30m"
  DB_CONN_MAX_IDLE_TIME: "5m"

secrets:
  existingSecret: ""
  DB_URL: "postgres://user:pass@db:5432/2fa?sslmode=require"
  RESTORE_DB_URL: "postgres://user:pass@db-restore:5432/2fa_restore?sslmode=require"
  REDIS_URL: "redis://redis:6379/0"
  JWT_SECRET: "CHANGE_ME"
  ADMIN_JWT_SECRET: "CHANGE_ME"
  RADIUS_SECRET: "CHANGE_ME"
  EXPRESS_MOBILE_URL: "https://api.express-mobile.local"
  EXPRESS_MOBILE_KEY: "CHANGE_ME"
  FCM_SERVER_KEY: "CHANGE_ME"

externalSecrets:
  enabled: false
  refreshInterval: "1h"
  secretStore:
    name: "vault-backend"
    kind: "ClusterSecretStore"
  target:
    name: ""
    creationPolicy: "Owner"
  data:
    DB_URL: "secret/data/2fa#DB_URL"
    RESTORE_DB_URL: "secret/data/2fa#RESTORE_DB_URL"
    REDIS_URL: "secret/data/2fa#REDIS_URL"
    JWT_SECRET: "secret/data/2fa#JWT_SECRET"
    ADMIN_JWT_SECRET: "secret/data/2fa#ADMIN_JWT_SECRET"
    RADIUS_SECRET: "secret/data/2fa#RADIUS_SECRET"
    EXPRESS_MOBILE_URL: "secret/data/2fa#EXPRESS_MOBILE_URL"
    EXPRESS_MOBILE_KEY: "secret/data/2fa#EXPRESS_MOBILE_KEY"
    FCM_SERVER_KEY: "secret/data/2fa#FCM_SERVER_KEY"

restoreTest:
  enabled: false
  schedule: "0 4 * * 0"
  image: "postgres:15"
