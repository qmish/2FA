<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>2FA Console</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main class="container">
      <header class="header">
        <h1>2FA Console</h1>
        <p class="muted">Базовый UI для проверки auth/2FA и сессий.</p>
      </header>

      <section class="card">
        <h2>Login</h2>
        <div class="grid">
          <label>Username
            <input id="login-username" placeholder="email/phone/username" />
          </label>
          <label>Password
            <input id="login-password" type="password" />
          </label>
          <label>Channel
            <select id="login-channel">
              <option value="web">web</option>
              <option value="mobile">mobile</option>
              <option value="vpn">vpn</option>
              <option value="mail">mail</option>
              <option value="rdp">rdp</option>
              <option value="ssh">ssh</option>
            </select>
          </label>
          <label>Method
            <select id="login-method">
              <option value="otp">otp</option>
              <option value="totp">totp</option>
              <option value="push">push</option>
              <option value="call">call</option>
              <option value="recovery">recovery</option>
            </select>
          </label>
        </div>
        <div class="row">
          <button id="login-btn">Login</button>
          <button id="passkey-login-btn" class="secondary">Login with passkey</button>
          <span id="login-status" class="badge error hidden">Ошибка</span>
          <span id="passkey-login-status" class="badge error hidden">Ошибка</span>
        </div>
        <pre id="login-result" class="result"></pre>
      </section>

      <section class="card">
        <h2>Register</h2>
        <p class="hint">Регистрация по инвайт-токену.</p>
        <div class="grid">
          <label>Invite token
            <input id="register-token" placeholder="invite token" />
          </label>
          <label>Username
            <input id="register-username" placeholder="username" />
          </label>
          <label>Password
            <input id="register-password" type="password" />
          </label>
          <label>Email
            <input id="register-email" placeholder="email" />
          </label>
          <label>Phone
            <input id="register-phone" placeholder="+79990000000" />
          </label>
        </div>
        <div class="row">
          <button id="register-btn">Register</button>
          <span id="register-status" class="badge error hidden">Ошибка</span>
        </div>
        <pre id="register-result" class="result"></pre>
      </section>

      <section class="card">
        <h2>Healthcheck</h2>
        <div class="row">
          <button id="health-btn">Check /healthz</button>
          <span id="health-badge" class="badge">unknown</span>
          <span id="health-status" class="badge error hidden">Ошибка</span>
        </div>
        <pre id="health-result" class="result"></pre>
      </section>

      <section class="card">
        <h2>Metrics</h2>
        <div class="row">
          <button id="metrics-btn">Fetch /metrics</button>
          <span id="metrics-status" class="badge error hidden">Ошибка</span>
        </div>
        <pre id="metrics-result" class="result mono"></pre>
      </section>

      <section class="card">
        <h2>Verify 2FA</h2>
        <div class="grid">
          <label>User ID
            <input id="verify-user" placeholder="user_id" />
          </label>
          <label>Challenge ID
            <input id="verify-challenge" placeholder="challenge_id" />
          </label>
          <label>Method
            <select id="verify-method">
              <option value="otp">otp</option>
              <option value="totp">totp</option>
              <option value="push">push</option>
              <option value="call">call</option>
              <option value="recovery">recovery</option>
            </select>
          </label>
          <label>Code
            <input id="verify-code" placeholder="код/answer" />
          </label>
        </div>
        <div class="row">
          <button id="verify-btn">Verify</button>
          <span id="verify-status" class="badge error hidden">Ошибка</span>
        </div>
        <pre id="verify-result" class="result"></pre>
      </section>

      <section class="card">
        <h2>Sessions</h2>
        <div class="row">
          <button id="sessions-btn">List active sessions</button>
          <button id="logout-btn" class="secondary">Logout (current)</button>
          <span id="sessions-status" class="badge error hidden">Ошибка</span>
        </div>
        <p class="hint">Время отображается в ISO времени.</p>
        <div class="row">
          <button id="current-session-btn" class="secondary">Current session</button>
        </div>
        <div id="current-session" class="details"></div>
        <div class="grid">
          <label>Session ID
            <input id="session-id" placeholder="session_id" />
          </label>
          <label>Revoke all
            <select id="revoke-all">
              <option value="false">only by id</option>
              <option value="true">all except current</option>
            </select>
          </label>
        </div>
        <button id="revoke-btn" class="secondary">Revoke session(s)</button>
        <h3>Sessions list</h3>
        <div id="sessions-list" class="table"></div>
        <pre id="sessions-result" class="result"></pre>
      </section>

      <section class="card">
        <h2>Devices</h2>
        <div class="row">
          <button id="devices-btn">List devices</button>
          <span id="devices-status" class="badge error hidden">Ошибка</span>
        </div>
        <div class="grid">
          <label>Device ID
            <input id="device-id" placeholder="device_id" />
          </label>
        </div>
        <button id="device-disable-btn" class="secondary">Disable device</button>
        <div id="devices-list" class="table"></div>
        <pre id="devices-result" class="result"></pre>
      </section>

      <section class="card">
        <h2>Factors</h2>
        <div class="row">
          <button id="factors-btn">Get factors</button>
          <span id="factors-status" class="badge error hidden">Ошибка</span>
        </div>
        <pre id="factors-result" class="result"></pre>
      </section>

      <section class="card">
        <h2>Passkeys</h2>
        <div class="row">
          <button id="passkeys-btn">List passkeys</button>
          <span id="passkeys-status" class="badge error hidden">Ошибка</span>
        </div>
        <div class="grid">
          <label>Passkey ID
            <input id="passkey-id" placeholder="passkey_id" />
          </label>
        </div>
        <button id="passkey-delete-btn" class="secondary">Delete passkey</button>
        <div id="passkeys-list" class="table"></div>
        <pre id="passkeys-result" class="result"></pre>
      </section>

      <section class="card">
        <h2>Tokens</h2>
        <div class="grid">
          <label>Access token
            <textarea id="access-token" rows="3" readonly></textarea>
          </label>
          <label>Refresh token
            <textarea id="refresh-token" rows="3"></textarea>
          </label>
        </div>
        <div class="row">
          <button id="refresh-btn">Refresh token</button>
          <button id="lockout-btn" class="secondary">Lockout status</button>
          <span id="tokens-status" class="badge error hidden">Ошибка</span>
        </div>
        <pre id="tokens-result" class="result"></pre>
      </section>

      <section class="card">
        <h2>TOTP</h2>
        <p class="hint">Настройка TOTP для текущего пользователя (нужен access token).</p>
        <div class="row">
          <button id="totp-setup-btn">Setup TOTP</button>
          <button id="totp-disable-btn" class="secondary">Disable TOTP</button>
          <span id="totp-setup-status" class="badge error hidden">Ошибка</span>
        </div>
        <pre id="totp-setup-result" class="result"></pre>
      </section>

      <section class="card">
        <h2>Recovery codes</h2>
        <p class="hint">Генерация recovery codes для текущего пользователя (нужен access token).</p>
        <div class="row">
          <button id="recovery-generate-btn">Generate recovery codes</button>
          <button id="recovery-clear-btn" class="secondary">Clear recovery codes</button>
          <span id="recovery-status" class="badge error hidden">Ошибка</span>
        </div>
        <pre id="recovery-result" class="result"></pre>
      </section>

      <section class="card">
        <h2>Admin login</h2>
        <div class="grid">
          <label>Username
            <input id="admin-login-username" placeholder="admin username" />
          </label>
          <label>Password
            <input id="admin-login-password" type="password" />
          </label>
        </div>
        <div class="row">
          <button id="admin-login-btn">Login as admin</button>
          <button id="admin-token-clear" class="secondary">Clear admin token</button>
          <span id="admin-login-status" class="badge error hidden">Ошибка</span>
        </div>
        <pre id="admin-login-result" class="result"></pre>
      </section>

      <section id="admin-locked" class="card">
        <h2>Admin</h2>
        <p class="hint">Админские настройки скрыты. Войдите как admin, чтобы открыть разделы.</p>
      </section>

      <div id="admin-sections" class="hidden">
        <section class="card">
          <h2>Admin invites</h2>
          <p class="hint">Создание инвайтов для регистрации пользователей.</p>
          <div class="grid">
            <label>Admin token
              <textarea id="admin-invites-token" rows="2" placeholder="admin JWT"></textarea>
            </label>
            <label>Email
              <input id="admin-invites-email" placeholder="user@example.com" />
            </label>
            <label>Phone
              <input id="admin-invites-phone" placeholder="+79990000000" />
            </label>
            <label>Role
              <select id="admin-invites-role">
                <option value="user">user</option>
                <option value="admin">admin</option>
              </select>
            </label>
            <label>TTL minutes
              <input id="admin-invites-ttl" type="number" min="1" placeholder="1440" />
            </label>
          </div>
          <div class="row">
            <button id="admin-invites-btn">Create invite</button>
            <span id="admin-invites-status" class="badge error hidden">Ошибка</span>
          </div>
          <pre id="admin-invites-result" class="result"></pre>
        </section>

        <section class="card">
          <h2>Admin audit</h2>
          <p class="hint">Время отображается в ISO времени.</p>
          <div class="grid">
            <label>Admin token
              <textarea id="admin-token" rows="2" placeholder="admin JWT"></textarea>
            </label>
            <label>Action
              <input id="audit-action" placeholder="logout / login / lockout_create" />
            </label>
            <label>Entity type
              <input id="audit-entity" placeholder="session / user / lockout" />
            </label>
            <label>Actor user
              <input id="audit-actor" placeholder="actor_user_id" />
            </label>
            <label>Query
              <input id="audit-query" placeholder="search in payload/ip/entity" />
            </label>
          </div>
          <div class="row">
            <button id="audit-btn">Load audit events</button>
            <button id="audit-export-btn" class="secondary">Export audit CSV</button>
            <span id="audit-status" class="badge error hidden">Ошибка</span>
          </div>
          <div id="audit-list" class="table"></div>
          <pre id="audit-result" class="result"></pre>
        </section>

        <section class="card">
          <h2>Admin sessions</h2>
          <p class="hint">Время отображается в ISO времени.</p>
          <div class="grid">
            <label>Admin token
              <textarea id="admin-sessions-token" rows="2" placeholder="admin JWT"></textarea>
            </label>
            <label>User ID
              <input id="admin-sessions-user" placeholder="user_id" />
            </label>
            <label>Active only
              <select id="admin-sessions-active">
                <option value="true">true</option>
                <option value="false">false</option>
              </select>
            </label>
            <label>IP
              <input id="admin-sessions-ip" placeholder="127.0.0.1" />
            </label>
            <label>User-Agent
              <input id="admin-sessions-ua" placeholder="user_agent" />
            </label>
          </div>
          <div class="row">
            <button id="admin-sessions-btn">Load sessions</button>
            <span id="admin-sessions-status" class="badge error hidden">Ошибка</span>
          </div>
          <div id="admin-sessions-list" class="table"></div>
          <pre id="admin-sessions-result" class="result"></pre>
        </section>

        <section class="card">
          <h2>Admin lockouts</h2>
          <p class="hint">Время отображается в ISO времени.</p>
          <div class="grid">
            <label>Admin token
              <textarea id="admin-lockouts-token" rows="2" placeholder="admin JWT"></textarea>
            </label>
            <label>User ID
              <input id="admin-lockouts-user" placeholder="user_id" />
            </label>
            <label>IP
              <input id="admin-lockouts-ip" placeholder="127.0.0.1" />
            </label>
            <label>Reason
              <input id="admin-lockouts-reason" placeholder="too_many_attempts" />
            </label>
            <label>Active only
              <select id="admin-lockouts-active">
                <option value="true">true</option>
                <option value="false">false</option>
              </select>
            </label>
          </div>
          <div class="row">
            <button id="admin-lockouts-btn">Load lockouts</button>
            <button id="admin-lockouts-clear" class="secondary">Clear lockouts</button>
            <span id="admin-lockouts-status" class="badge error hidden">Ошибка</span>
          </div>
          <div id="admin-lockouts-list" class="table"></div>
          <pre id="admin-lockouts-result" class="result"></pre>
        </section>
      </div>
    </main>

    <script src="app.js"></script>
  </body>
</html>
